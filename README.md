# EV3-Item-Searcher
EV3 system programmed to traverse a room in search of a target item.

Description:

The robot we created is designed to search for an item in the room, by its colour. We do this by allowing the user to select a colour from the interactive menu we created on the EV3’s LCD screen. Once the user selects what colour the robot should search for, the robot starts traversing the room where we assume the robots starting position is (0,0). Throughout its traversal, the robot uses a colour sensor to scan for the target colour, and once the robot scans the target colour it reacts in a way to indicate it has found the item. Of course, there is also the possibility where the robot does not find the target item but should stop once it has searched the whole room, and not run indefinitely. To overcome this problem, we are using the ultrasonic sensor and the touch sensor to control the traversal and the maximum path of the robot. The maximum path we set for the robot is, firstly an up-down traversal of the room, and secondly a side-by-side traversal of the room. If the robot doesn’t find an item by the time these two traversals are complete, the robot reacts in a way to indicate it hasn’t found the item.

CLASSES

----------------------------------Main----------------------------------

This is where the main() method runs. When run, the first thing it does is create a hash map with a string representation of colours mapped to their integer RGB values, e.g. “Red” mapped to Color.RED. Then, an array of these colour strings and a counter to track indices is created. The next part is a display on the EV3 LCD screen with greeting messages and information about the authors of the system. Then the program enters a while loop to allow the user to select a colour from this colour array, which the robot will search for. The colour selected should match the colour of the item to be searched, as the robot searches for the item by its colour. The user can scroll through the colour array by pressing the UP and DOWN keys and the counter is used to track which colour is displayed/selected from this menu. Once the user presses the ENTER key the while loop ends and the colour displayed is selected, the selected colour has the index value corresponding to the value of the counter, which we use later. After the colour has been selected, the main method creates a MovePilot object by calling the static method pilotBuilder, it passes information about the chassis of the robot as parameters, i.e. the motor ports being used, the wheel diameter and the axle length. Once the MovePilot object is instantiated, an OdometryPoseProvider is also created using the MovePilot object. A Flags object is instantiated. Then, an object for each Behavior class is instantiated and put inside a Behavior array. An Arbitrator is instantiated using this array as a parameter and its returnWhenInactive field set to True. By setting it to True, we are telling the arbitrator to stop running when all the takeControl methods of behaviours return False, and once the arbitrator stops the main method ends, gracefully shutting our program.

----------------------------------Calibrate----------------------------------

Calibrate is used to instantiate each sensor we make use of once. By assigning these objects to static fields, and giving them getter methods, we can make use of them throughout our program without the need to instantiate them every time we use them.

----------------------------------Flags----------------------------------

Flags has five fields. The field traversed tracks how many times the robot has traversed the room, and once its value is 2 the robot assumes the path has been completed. The field pose is used to store the pose of the item if it is found. The field found is set to True if the item is found. The field foundReaction is set to True if the robot has found the item or has completed its path without finding it. The field lowBatLevel is set to True if the robot’s battery level is below a certain value. Once a Flags object is instantiated it is passed as a parameter to all the behaviour objects. It is used to control the interdependence between the behaviours, and to make sure the arbitrator ends when at the point we aim it to, i.e. if the battery is low, EmergencyStop is activated, item has been found or the robot completed its path without finding the item.

----------------------------------EmergencyStop----------------------------------

EmergencyStop is a Behaviour class that indirectly stops the program from running. This behaviour takes control if the ESCAPE button on the EV3 is pressed or the lowBatteryLevel field of the Flags object is True. In its action, certain fields of the Flags object are manipulated to make all other Behavior classes return False in their take control methods so that the arbitrator stops. 

----------------------------------BatteryLevel----------------------------------

BatteryLevel is another Behaviour class that indirectly stops the program from running. This behaviour takes control if the battery of the robot is below 6.0V and the action method hasn’t run before. We check this using the Flags object, particularly by looking at the lowBatLevel field, which is initialised as False, and is set to True only when the action method of this behaviour runs.  In the action method, we also stop the pilot, make the robot beep twice and display a message to indicate the battery is running low. EmergencyStop and this class are dependent on one another as in, EmergencyStop takes control if this behaviour has taken control.

----------------------------------FoundReaction----------------------------------

FoundReaction is a Behavior class that makes the robot “react” to finding/not finding an item. This behaviour takes control if the Flags object fields found is True or traversed is equal to 2, i.e. the item has been found or the robot has completed its path without finding the item, and the action method hasn’t run before, which is the case if the foundReact field is False. In its action, if the item is found the robot displays the items pose on its LCD screen and calls the tune method by passing it a file object instantiated using the Tada.wav file found in https://www.winhistory.de/more/winstart/winstart_en.htm (Last accessed on 1:16 pm on 19th of March), the tune method is used to play the wav file it takes as a parameter. Otherwise, if the robot has not found, the robot displays it on its LCD screen and plays a beep sequence. Finally, the action method ends by setting the foundReact field to True.

----------------------------------SearchItem----------------------------------

SearchItem is a Behavior class that uses the colour sensor to scan for the target colour selected in the menu. It takes control if the sensor has scanned a colour matching the RGB values of the target colour and the item hasn’t been found yet, which is when the found field of the Flags object is False. In its action the pilot is stopped, the pose field of the Flags object is set as the current pose of the robot, and the found field is set to True to indicate the item has been found.

----------------------------------TurnNinety----------------------------------

TurnNinety is a Behavior class that is used to rotate the robot at certain points, during its movement. The robot’s movement is mostly moving in a straight line. At the end of each straight, the robot comes across a wall and hits it, which is then picked up by the touch sensor, triggering the action method of this behaviour. In its action method, the robot is made to backup a small distance from the wall and turn 90 degrees. Since the robot is meant to rotate 90 degrees in a certain direction, i.e. clockwise or anti-clockwise, every time it comes to the end of a straight line, we use two fields called tracker_90 and tracker_neg90, to track these rotations and appropriately execute them in a correct sequence. Once the robot rotates 90 degrees in the correct direction, the ultrasonic sensor is used to check the robot’s distance from the wall. If this distance is less than 15cm the robot should rotate 180 degrees since it has come to the end of its initial traversal, i.e. up-down traversal, and starts its next traversal, i.e. side-to-side traversal. This action takes place a maximum of two times, as every time the robot rotates 180 degrees the traversed field of the Flags object is incremented once, and when the value of traversed is 2 the program will end. If the robot isn’t at the end of its path, i.e. the value from the ultrasonic sensor is greater than 15cm, the robot travels a short distance and again turns 90 degrees in the correct direction to carry on with its path. The reason we only use the ultrasonic sensor at that certain point is that if we otherwise use it continuously, every time the robot comes to the end of a straight line, it will assume the path is completed which is not what we want.

----------------------------------GoForward----------------------------------

GoForward is a Behavior class that pilots the robot to go forward until the item is found, i.e. if the found field of Flags object is False.
